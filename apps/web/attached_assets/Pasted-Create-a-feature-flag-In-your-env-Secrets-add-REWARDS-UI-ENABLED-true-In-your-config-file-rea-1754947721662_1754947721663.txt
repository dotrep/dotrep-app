Create a feature flag

In your env (Secrets): add REWARDS_UI_ENABLED=true.

In your config file, read the flag; if false, skip all UI listed below.

Define the reward event contract

Decide on a single event name you already use or can easily emit, e.g., xp:granted.

Event payload (server → client) should include: { userId, amount, reasonKey, createdAt, txnId }.

Maintain a short canonical list of reasonKey values (e.g., onboarding.step_complete, vault.upload, wallet.connect).

Persist reward entries (server)

Add a lightweight collection/table reward_events with a unique index on txnId to prevent duplicates.

On any action that yields XP, write one row with the payload above; return the event in the API response.

Do not change existing XP math or balances—this is additive logging only.

Expose a minimal API for the client

GET /api/rewards/recent?limit=10 — returns the 10 most recent reward events for the authenticated user.

GET /api/rewards/since?cursor=<iso> — optional, for polling incremental updates.

Keep your current endpoints intact; this is a new read‑only surface.

Wire the client (opt‑in only)

If REWARDS_UI_ENABLED is false, render nothing and do not import the rewards code.

If true, on app bootstrap:

Start a lightweight poll (e.g., every 20–30s) against /api/rewards/since or subscribe to your existing event bus if you have one.

On new event for the signed‑in user, trigger a non‑blocking toast: “+{amount} XP · {friendlyReason}”.

Update a right‑side or profile dropdown “Recent rewards” panel that lists the last 5 items with timestamps.

Friendly copy & mapping

Create a reason map file (no logic changes):

onboarding.step_complete → “Onboarding step completed”

vault.upload → “File stored in FreeSpace”

wallet.connect → “Wallet connected”

Keep strings in one place for easy theme/i18n.

Visuals and accessibility

Use your existing theme tokens for the toast and panel; no new colors.

Respect reduced‑motion setting; if true, disable confetti/animations.

QA checklist (before enabling flag)

Grant XP via each key action and confirm: row persists, API returns it, toast shows once, panel updates.

Toggle REWARDS_UI_ENABLED=false and confirm the app behaves exactly as today.